# Nginx Konfigurationsdatei für Reverse Proxy

# HTTP-Level Konfiguration
http {
    # Upstream: Prometheus
    # Das sagt Nginx: "Wenn jemand zu /prometheus geht,
    # leite es zu http://prometheus:9090 weiter"
    upstream prometheus {
        server prometheus:9090;
    }
    
    # Upstream: Grafana
    # Das sagt Nginx: "Wenn jemand zu /grafana geht,
    # leite es zu http://grafana:3000 weiter"
    upstream grafana {
        server grafana:3000;
    }
    
    # Der Main Server Block
    server {
        listen 80;
        server_name _;
        
        # Root - Einfache Übersichtsseite
        location / {
            root /usr/share/nginx/html;
            try_files $uri /index.html;
        }
        
        # Prometheus auf /prometheus
        location /prometheus/ {
            # Proxy-Headers damit Prometheus weiß, wo es läuft
            proxy_pass http://prometheus/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # Grafana auf /grafana
        location /grafana/ {
            # Proxy-Headers
            proxy_pass http://grafana/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # Grafana braucht diese speziellen Headers
            proxy_set_header X-Forwarded-Prefix /grafana;
        }
    }
}

events {}
